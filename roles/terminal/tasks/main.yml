- name: Ensure terminal tools are installed
  community.general.homebrew:
    name:
      - bash
      - bash-completion
      - fish
      - starship
      - tmux
      - tmux-mem-cpu-load
    state: present

# - name: Ensure ZSH is installed
#   community.general.homebrew:
#     name:
#       - zsh
#       - zsh-completions
#       - zsh-syntax-highlighting
#     state: present

# Alternate commands that take care of the following tasks
#   echo $(brew --prefix)/bin/fish | sudo tee -a /etc/shells
#   chsh -s $(brew --prefix)/bin/fish
- name: Setup Fish as the default shell for the user
  become: true
  block:
    - name: Ensure Fish is a valid shell
      ansible.builtin.lineinfile:
        path: /etc/shells
        state: present
        line: "{{ brew_prefix }}/bin/fish"
    - name: Setup the default shell for the {{ ansible_env.USER }} user
      ansible.builtin.user:
        name: "{{ ansible_env.USER }}"
        shell: "{{ brew_prefix }}/bin/fish"
  tags:
    - privileged

- name: Fish configuration
  block:
    - name: Ensure the configuration directory for Fish exists
      ansible.builtin.file:
        path: ~/.config/fish
        state: directory
        mode: 0755

    - name: Copy the Fish configuration
      ansible.builtin.copy:
        dest: ~/.config/fish
        src: fish/

- name: Starship configuration
  ansible.builtin.copy:
    dest: ~/.config
    src: starship/
    mode: 0644

- name: Install FZF
  command: "{{ brew_prefix }}/opt/fzf/install --no-zsh --no-bash --all"
  args:
    creates: ~/.config/fish/functions/fzf_key_bindings.fish

- name: Alacritty configuration
  block:
    - name: Ensure the configuration directory for Alacritty exists
      ansible.builtin.file:
        path: ~/.config/alacritty
        state: directory
        mode: 0755

    - name: Copy the Alacritty configuration
      ansible.builtin.copy:
        dest: ~/.config/alacritty
        src: alacritty/

- name: Tmux configuration
  block:
    - name: Ensure the configuration directory for Tmux exists
      ansible.builtin.file:
        path: ~/.config/tmux
        state: directory
        mode: 0755

    - name: Copy the Tmux configuration
      ansible.builtin.copy:
        dest: ~/.config/tmux
        src: tmux/
